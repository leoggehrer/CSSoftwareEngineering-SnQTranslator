@*@CodeCopy*@
@{
    @using SnQTranslator.AspMvc.Modules.Language
    @using SnQTranslator.AspMvc.Modules.View
    @model SnQTranslator.AspMvc.Models.IdentityModel

    var viewBagWrapper = new ViewBagWrapper(ViewBag);
    var controller = ViewContext.RouteData.Values["controller"].ToString();
    var action = ViewContext.RouteData.Values["action"].ToString();
    Func<string, string> translate = Translator.TranslateIt;
    Func<string, string> translateFor = pn => translate($"{controller}.{pn}");
    var displayViewModel = viewBagWrapper.CreateDisplayViewModel(controller, Model);

    Model.ViewBagInfo = viewBagWrapper;

    @foreach (var item in displayViewModel.DisplayProperties)
    {
        Model.ViewBagInfo.Handled = false;
        Model.ViewBagInfo.DisplayProperty = item;

        <dl class="row">
            <dt class="col-sm-2">
                @translateFor(displayViewModel.GetLabel(item))
            </dt>
            <dd class="col-sm-10">
                @await Html.PartialAsync("_DisplayControl", Model)
                @if (Model.ViewBagInfo.Handled == false)
                {
                    @displayViewModel.GetDisplayValue(item)
                }
            </dd>
        </dl>
    }
}
